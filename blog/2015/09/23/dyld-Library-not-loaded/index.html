<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>dyld: Library not loaded &amp; CocoaPods | NSTorres</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="This morning I woke up to a not so great âœ‰ from a PR I submitted the day before; it read something like this:  I can build in the simulator perfectly fine but trying to get a build onto a device this">
<meta name="keywords" content="swift2,cocoapods,rpath,error">
<meta property="og:type" content="article">
<meta property="og:title" content="dyld: Library not loaded &amp; CocoaPods">
<meta property="og:url" content="https://estebantorr.es/blog/2015/09/23/dyld-Library-not-loaded/index.html">
<meta property="og:site_name" content="NSTorres">
<meta property="og:description" content="This morning I woke up to a not so great âœ‰ from a PR I submitted the day before; it read something like this:  I can build in the simulator perfectly fine but trying to get a build onto a device this">
<meta property="og:image" content="http://i0.kym-cdn.com/photos/images/newsfeed/000/962/640/658.png">
<meta property="og:image" content="http://rs1322.pbsrc.com/albums/u572/SpamMe06/headbang_zps2ac29901.gif~c200">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/1169297/7726958/9156c376-fefd-11e4-90c8-2412f67f52c2.png">
<meta property="og:updated_time" content="2018-02-23T11:27:37.986Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dyld: Library not loaded &amp; CocoaPods">
<meta name="twitter:description" content="This morning I woke up to a not so great âœ‰ from a PR I submitted the day before; it read something like this:  I can build in the simulator perfectly fine but trying to get a build onto a device this">
<meta name="twitter:image" content="http://i0.kym-cdn.com/photos/images/newsfeed/000/962/640/658.png">
  
    <link rel="alternative" href="/atom.xml" title="NSTorres" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-47828981-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','uwyYBdypyPP1E3sYyyQf','2.0.0');
</script>

</head>

<body>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">NSTorres</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/tags">Tags</a></li><li><a href="/archives">Archives</a></li><li><a href="/talks">Talks</a></li><li><a href="/about">About Me</a></li><li><a href="https://estebantorr.es/cv">CV</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://estebantorr.es"></form>
	</div>
</header>
    <div id="main">
      <article id="post-dyld-Library-not-loaded" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/blog/2015/09/23/dyld-Library-not-loaded/" class="article-date">
  <time datetime="2015-09-23T13:14:17.000Z" itemprop="datePublished">2015-09-23</time>
</a>
		</span>
		<span class="meta-elements author">Esteban Torres</span>
		<div class="commentscount">
			
				<a href="https://estebantorr.es/blog/2015/09/23/dyld-Library-not-loaded/#disqus_thread" class="article-comment-link">Comments</a>
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      dyld: Library not loaded &amp; CocoaPods
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>This morning I woke up to a not so great âœ‰ from a <code>PR</code> I submitted the day before; it read something like this:</p>
<blockquote>
<p>I can build in the simulator perfectly fine but trying to get a build onto a device this morning was not happening at all</p>
</blockquote>
<p>And with that I started my day trying to figure out what was going on.</p>
<a id="more"></a>
<h1 id="The-culprit"><a href="#The-culprit" class="headerlink" title="The culprit"></a>The culprit</h1><p>It wasnâ€™t hard to determine what was the issue given that the console was spitting the following message:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dyld: Library not loaded: @rpath/AFNetworking.framework/AFNetworking</div><div class="line">  Referenced from: /var/mobile/Containers/Bundle/Application/6C4D36F9-6481-434C-8713-18EC38A0FBF6/&lt;appname&gt;.app/&lt;appname&gt;</div><div class="line">  Reason: image not found</div><div class="line">(lldb)</div></pre></td></tr></table></figure></p>
<p>It was pretty straight forward, <code>@rpath</code> was borked.</p>
<h2 id="rpath-errors"><a href="#rpath-errors" class="headerlink" title="@rpath errors"></a><code>@rpath</code> errors</h2><p>If youâ€™ve had the delight of actually play around with <code>Swift</code> and <code>Dyanmic Frameworks</code> youâ€™ve more than likely came across at least one <code>@rpath</code> error.</p>
<p>What this means basically is that either your runtime path(s) are borked or that your frameworks are not getting copied/embedded into the <code>Frameworks</code> Â«sectionÂ» of your application (letâ€™s leave it like this for simplicityâ€™s sake).</p>
<h1 id="Â«FixingÂ»-the-issue"><a href="#Â«FixingÂ»-the-issue" class="headerlink" title="Â«FixingÂ» the issue"></a>Â«FixingÂ» the issue</h1><p><img src="http://i0.kym-cdn.com/photos/images/newsfeed/000/962/640/658.png" alt=""></p>
<p>I went on to check the runtime paths and sure as hell everything was correct, without much to worry about I turned to check if my frameworks were being copied/embedded to their respective places and sure they wereâ€¦</p>
<p>I was starting to worry and also running out of ideas so I decided to check my <code>CocoaPods</code> definition and I noticied a couple of things with how the <code>Podfile</code> was structured.</p>
<p>I decided that this was a chance as good as any to refactor the <code>Podfile</code> and also fix the issue. And with this in mind I separated the pods by <code>target</code> and also created some Â«shared podsÂ» definition; added some <code>:exlusive =&gt; true</code> decorations here and there and voilÃ¡! I was ready for the test.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod install</div></pre></td></tr></table></figure>
<p>Compile and ðŸ’¥ â€¦ did not workâ€¦</p>
<h1 id="Turning-to-almighty-and-wise-internet"><a href="#Turning-to-almighty-and-wise-internet" class="headerlink" title="Turning to almighty and wise internet"></a>Turning to almighty and wise internet</h1><p>After <em>successfully</em> failling at fixing the issue I turned to old and wise internet just to bump my head against a wall multiple timesâ€¦</p>
<p><img src="http://rs1322.pbsrc.com/albums/u572/SpamMe06/headbang_zps2ac29901.gif~c200" alt=""></p>
<h1 id="Pre-During-and-Post-Frustration"><a href="#Pre-During-and-Post-Frustration" class="headerlink" title="Pre, During and Post Frustration"></a>Pre, During and Post Frustration</h1><p>Closing to 7 or so hours I decided to do what I think I should have done from the beginningâ€¦ created a new empty project; bare bones with only the <code>Podfile</code> being an complete replica of the failing project.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod install</div></pre></td></tr></table></figure>
<p>And lo and beholdâ€¦ the project compiles and runs on my device as expectedâ€¦</p>
<p>That was equal parts promising and infuriatingâ€¦ Since I didnâ€™t want to move everything to a new clean project (and more so I shouldnâ€™t need to do that) I decided to check for differences between <code>@rpath</code> in both projects.</p>
<p>After some time both projects looked the same and I even added some Â«missingÂ» build phases (run scripts from <code>CocoaPods</code>) to my original project and some missing header paths.</p>
<p>Everything was looking nice ðŸŒ…â€¦ until I decided to run on my device and faced the same issueâ€¦</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>After checking the error it looked like the same but slightly differentâ€¦ so minuscule that it was actually key to find the answerâ€¦</p>
<p>The current error was the following:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dyld: Library not loaded: @rpath/Pods.framework/Pods</div></pre></td></tr></table></figure></p>
<p>While in theory it was the same; it actually conveyed a totally different meaning.</p>
<p>Looking at <code>CocoaPods</code> issues I came accross <a href="https://github.com/CocoaPods/CocoaPods/issues/3586" target="_blank" rel="noopener">this one</a> that suggest the following:</p>
<blockquote>
<p>Okay, fixed. The issue was the Pods.framework was set to required and not optional. It wasnâ€™t being copied to device by the .sh script and so the app crashed. Setting this to optional fixed the issue.<br><img src="https://cloud.githubusercontent.com/assets/1169297/7726958/9156c376-fefd-11e4-90c8-2412f67f52c2.png" alt="https://cloud.githubusercontent.com/assets/1169297/7726958/9156c376-fefd-11e4-90c8-2412f67f52c2.png"></p>
</blockquote>
<p>Withouth giving it much thought I went to my original projectâ€¦ marked <code>Pods.framework</code> as Â«OptionalÂ»â€¦ compileâ€¦ runâ€¦ ðŸŽ‰</p>
<p>The application was running smoothly on my ðŸ“±â€¦</p>
<h1 id="Take-Aways"><a href="#Take-Aways" class="headerlink" title="Take Aways"></a>Take Aways</h1><p>This issue turned out to be a terrible waste of time but also helped me rearrange my list of steps to follow when debugging errors that should be Â«obviousÂ» from experience.</p>
<p>If after failing to due what experience tolds me is the answer; try to replicate the issue on a newly created project (or as clean as possible).</p>
<p>If you succeed in reproducing you are unto something new; if not then your project is borked and you now have a clean and functional project to compare and take bits from here and there.</p>
<p>ðŸ™‡</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
  <div class="article-category">
    <a class="article-category-link" href="/categories/cocoapods/">cocoapods</a>Â»<a class="article-category-link" href="/categories/cocoapods/tools/">tools</a>Â»<a class="article-category-link" href="/categories/cocoapods/tools/errors/">errors</a>
  </div>

			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cocoapods/">cocoapods</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/error/">error</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rpath/">rpath</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift2/">swift2</a></li></ul>

			</span>
		</div>
	</footer>
	
    
<nav id="article-nav">
  
    <a href="/blog/2015/09/26/How-to-and-not-ask-questionsâ€¦/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          How to (and not) ask questionsâ€¦
        
      </div>
    </a>
  
  
    <a href="/blog/2015/08/11/Semver-intermediate-versioning/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          Semver intermediate versioning
        
      </div>
    </a>
  
</nav>

  
</article>




<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:estebantorr.es">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">NSTorres</a>
	</h1>
	<span class="copyright">
		&copy; 2018 Esteban Torres<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    
<script>
  var disqus_shortname = 'ticobjc';
  
  var disqus_url = 'https://estebantorr.es/blog/2015/09/23/dyld-Library-not-loaded/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div>
</body>
</html>